[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
user=root

[program:xvfb]
command=/usr/bin/Xvfb :1 -screen 0 1920x1080x24 -ac +extension GLX +render -noreset
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/xvfb.log
stderr_logfile=/var/log/supervisor/xvfb.log
priority=10

[program:fluxbox]
command=/usr/bin/fluxbox
environment=DISPLAY=:1
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/fluxbox.log
stderr_logfile=/var/log/supervisor/fluxbox.log
priority=20

[program:x11vnc]
command=/usr/bin/x11vnc -display :1 -nopw -xkb -ncache 10 -ncache_cr -forever -shared -rfbport 5900
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/x11vnc.log
stderr_logfile=/var/log/supervisor/x11vnc.log
priority=30

[program:api]
command=uvicorn api:app --host 0.0.0.0 --port 8000
directory=/srv/src
environment=DISPLAY=:1
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/api.log
stderr_logfile=/var/log/supervisor/api.log
priority=40

[program:mcp]
command=python3 mcp_server.py
directory=/srv/src
environment=DISPLAY=:1
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/mcp.log
stderr_logfile=/var/log/supervisor/mcp.log
priority=50

[program:novnc]
command=websockify --web=/opt/noVNC 6080 localhost:5900
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/novnc.log
stderr_logfile=/var/log/supervisor/novnc.log
priority=60

[program:streamlit]
command=streamlit run streamlit_app.py --server.port=8501 --server.address=0.0.0.0 --server.headless=true
directory=/srv/src
environment=DISPLAY=:1
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/streamlit.log
stderr_logfile=/var/log/supervisor/streamlit.log
priority=70
